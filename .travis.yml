language: php

php:
  - '7.3'
  - '7.2'

dist: xenial

services:
  - mysql

env:
  global:
    - PHALCON_VERSION=v4.0.0-beta.2
    - DB_NAME=incubator_test

cache:
  timeout: 604800
  directories:
    - ${HOME}/.composer/cache

before_install:
  - |
    # Hide "You are in 'detached HEAD' state" message
    git config --global advice.detachedHead false

install:
  - pecl install --force psr
  - tests/_ci/install-phalcon.sh
  - echo extension=phalcon.so | tee -a "$(phpenv prefix)/etc/php.ini"

before_script:
  - mysql -e 'CREATE DATABASE IF NOT EXISTS incubator_test CHARSET=utf8 COLLATE=utf8_unicode_ci;'
  - travis_retry composer install --no-interaction --no-ansi --no-progress --no-suggest

script:
  - vendor/bin/codecept build --quiet
  - vendor/bin/codecept run

notifications:
  email: false
